!function(t){var e={};function i(n){if(e[n])return e[n].exports;var s=e[n]={i:n,l:!1,exports:{}};return t[n].call(s.exports,s,s.exports,i),s.l=!0,s.exports}i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)i.d(n,s,function(e){return t[e]}.bind(null,s));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=5)}([function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.withEvents=e.registerStore=e.BaseStore=e.Dispatcher=void 0;const n=i(2);Object.defineProperty(e,"Dispatcher",{enumerable:!0,get:function(){return n.Dispatcher}});const s=i(9);Object.defineProperty(e,"BaseStore",{enumerable:!0,get:function(){return s.BaseStore}}),Object.defineProperty(e,"registerStore",{enumerable:!0,get:function(){return s.registerStore}}),Object.defineProperty(e,"withEvents",{enumerable:!0,get:function(){return s.withEvents}})},function(t,e,i){"use strict";var n=this&&this.__awaiter||function(t,e,i,n){return new(i||(i=Promise))((function(s,r){function a(t){try{c(n.next(t))}catch(t){r(t)}}function o(t){try{c(n.throw(t))}catch(t){r(t)}}function c(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,o)}c((n=n.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),r=s.withEvents({All:""}),a={action_AddChannel(t){var e;return n(this,void 0,void 0,(function*(){const i=this.getState();null===(e=i.channels)||void 0===e||e.push(t),this.nextState(i)}))},action_RemoveChannel(t){return n(this,void 0,void 0,(function*(){this.getState().channels=this.getState().channels.filter(e=>e.id!==t.channelId)}))}};e.default=s.registerStore({init(){this.nextState({channels:[]})},actions:a,events:r})},function(t,e,i){"use strict";var n=this&&this.__awaiter||function(t,e,i,n){return new(i||(i=Promise))((function(s,r){function a(t){try{c(n.next(t))}catch(t){r(t)}}function o(t){try{c(n.throw(t))}catch(t){r(t)}}function c(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,o)}c((n=n.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.Dispatcher=void 0;const s=i(6),r=i(7),a=i(8),o=s.constantTree({DISPATCHER:{CYCLE:{START:"",END:"",RETREIVE_STORE_LIST:"",ABORT_ALREADY_RUNNING:"",START_PROCESSING:"",ANOTHER_CYCLE_PENDING:""},DISPATCH:{RECEIVE_PAYLOAD:"",SET_DEBUG_STATUS:""},STORE:{START_WAITING:"",CHECK_ACTION_NAME:"",WILL_PROCESS:"",WILL_NOT_PROCESS:"",EMIT:"",NEXT_STATE:"",REGISTERING_NEW:"",SEND_ACTION:""}}},"DEBUG");e.Dispatcher=class{constructor(){this._StoreHash={},this._payloads=[],this._currentPayload=null,this._cycle={},this._IsCycleRunning=!1,this._EvtBus=new r.EventBus(".",4),this._DebugMode=!1,this._DebugOrder=0,this._DebugCycleIdx=0}emitDbg(t,e){this._DebugMode&&this._EvtBus.emitAsync(t,{cycle:this._DebugCycleIdx,order:this._DebugOrder++,event:t,timestamp:(new Date).getTime(),data:e})}dispatch(t){return this.emitDbg(o.DISPATCHER.DISPATCH.RECEIVE_PAYLOAD,t),"SET_DEBUG_MODE_ON"===t.type?(this._DebugMode=!0,void this.emitDbg(o.DISPATCHER.DISPATCH.SET_DEBUG_STATUS,!0)):"SET_DEBUG_MODE_OFF"===t.type?(this.emitDbg(o.DISPATCHER.DISPATCH.SET_DEBUG_STATUS,!1),void(this._DebugMode=!1)):(this._payloads.push(t),void this.processNextCycle())}wait(t){return new Promise(e=>setTimeout(()=>e(),t))}registerStore(t,e){const i=this;if(t.id=null!=e?e:a.Guid.getGuid(),this.emitDbg(o.DISPATCHER.STORE.REGISTERING_NEW,t.id),t.nextState=function(e,n){this.state=n?Object.assign(Object.assign({},this.state),e):e,i.emitDbg(o.DISPATCHER.STORE.NEXT_STATE,{storeId:t.id,state:e,mergeToPreviousState:n})},t.sendAction=(e,n)=>{i.emitDbg(o.DISPATCHER.STORE.SEND_ACTION,{storeId:t.id,type:e,payload:n}),this.dispatch(Object.assign({type:e},n))},t.id in this._StoreHash)throw Error(`A store named ${t.id} already exists, maybe you are trying to add the same store several times...`);this._StoreHash[t.id]=t}processNextCycle(){var t,e;return n(this,void 0,void 0,(function*(){const i=this;if(this.emitDbg(o.DISPATCHER.CYCLE.START),this._IsCycleRunning||0===this._payloads.length)return this.emitDbg(o.DISPATCHER.CYCLE.ABORT_ALREADY_RUNNING),void this.emitDbg(o.DISPATCHER.CYCLE.END);this._IsCycleRunning=!0,this._currentPayload=this._payloads.shift(),this._cycle={};const s=[],r={};function a(t,e){if(i.emitDbg(o.DISPATCHER.STORE.START_WAITING),e.includes(t))throw Error(t+" cannot wait for itself to finish berofe it can finish... Cycling dependency detected.");if(t in r)throw Error(t+" already waiting in this current cycle, and it cannot wait a second time");e.forEach(e=>{if(e in r&&r[e].includes(t))throw Error(`Cycling dependency detected, store ${t} is trying to wait for store ${e} to finish, but ${e} is already waiting for ${t} to finish first`)}),r[t]=e}this.emitDbg(o.DISPATCHER.CYCLE.RETREIVE_STORE_LIST);for(const i in this._StoreHash){const r=this._StoreHash[i],c=null!==(e=null===(t=r.mappedActions)||void 0===t?void 0:t[this._currentPayload.type])&&void 0!==e?e:this._currentPayload.type;if(this.emitDbg(o.DISPATCHER.STORE.CHECK_ACTION_NAME,{storeId:r.id,payloadAction:this._currentPayload.type,selectedAction:c}),c in r)this.emitDbg(o.DISPATCHER.STORE.WILL_PROCESS,{storeId:r.id,willProcess:c}),this._cycle[i]=(()=>n(this,void 0,void 0,(function*(){const t=yield r[c](this._currentPayload,(...t)=>n(this,void 0,void 0,(function*(){a(i,t);for(const e of t)for(;!this._cycle[e];)yield this.wait(0);return Promise.all(t.map(t=>this._cycle[t]))})));return{id:r.id,result:t}})))();else if("dispatchHandler"in r){const t=this._StoreHash[i];this._cycle[i]=(()=>n(this,void 0,void 0,(function*(){const e=yield t.dispatchHandler(this._currentPayload,(...t)=>n(this,void 0,void 0,(function*(){a(i,t);for(const e of t)for(;!this._cycle[e];)yield this.wait(0);return Promise.all(t.map(t=>this._cycle[t]))})));return{id:t.id,result:e}})))()}else this.emitDbg(o.DISPATCHER.STORE.WILL_NOT_PROCESS,{storeId:r.id,willNotProcess:c}),this._cycle[i]=new Promise(t=>t({id:r.id,result:null}));s.push(this._cycle[i])}try{this.emitDbg(o.DISPATCHER.CYCLE.START_PROCESSING);(yield Promise.all(s)).forEach(t=>{null!==t.result&&(this._EvtBus.emitAsync(`STORE.${t.id}.EMIT.ALL`,this._StoreHash[t.id].state),this.emitDbg(o.DISPATCHER.STORE.EMIT,{storeId:t.id,event:`STORE.${t.id}.EMIT.ALL`,state:this._StoreHash[t.id].state}),"string"==typeof t.result&&"ALL"!==t.result&&(this._EvtBus.emitAsync(`STORE.${t.id}.EMIT.${t.result}`,this._StoreHash[t.id].state),this.emitDbg(o.DISPATCHER.STORE.EMIT,{storeId:t.id,event:`STORE.${t.id}.EMIT.${t.result}`,state:this._StoreHash[t.id].state})),Array.isArray(t.result)&&t.result.filter(t=>"ALL"!==t).forEach(e=>{this._EvtBus.emitAsync(`STORE.${t.id}.EMIT.${e}`,this._StoreHash[t.id].state),this.emitDbg(o.DISPATCHER.STORE.EMIT,{storeId:t.id,event:`STORE.${t.id}.EMIT.${e}`,state:this._StoreHash[t.id].state})}))})}catch(t){console.error(t)}finally{this._IsCycleRunning=!1,this.emitDbg(o.DISPATCHER.CYCLE.END),this._DebugCycleIdx++,this._payloads.length>0&&(yield this.wait(0),this.emitDbg(o.DISPATCHER.CYCLE.ANOTHER_CYCLE_PENDING),this.processNextCycle())}}))}subscribe(t,e,i="ALL"){return this._EvtBus.on(`STORE.${t}.EMIT.${i}`,e)}}},function(t,e,i){"use strict";var n=this&&this.__awaiter||function(t,e,i,n){return new(i||(i=Promise))((function(s,r){function a(t){try{c(n.next(t))}catch(t){r(t)}}function o(t){try{c(n.throw(t))}catch(t){r(t)}}function c(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,o)}c((n=n.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),r={action_AddUser(t){return n(this,void 0,void 0,(function*(){this.nextState({users:[...this.getState().users,Object.assign(Object.assign({},t),{channels:[]})]})}))},action_AddUserToChannel(t){return n(this,void 0,void 0,(function*(){const e=this.getState();e.users.filter(e=>e.id===t.userId)[0].channels.push(t.channelId),this.nextState(e)}))},action_RemoveUser(t){return n(this,void 0,void 0,(function*(){this.nextState({users:this.getState().users.filter(e=>e.id!==t.userId)})}))},action_RemoveChannel(t){return n(this,void 0,void 0,(function*(){this.getState().users.forEach(e=>{-1!==e.channels.indexOf(t.channelId)&&(e.channels=e.channels.filter(e=>e!==t.channelId))}),this.nextState(this.getState())}))}};e.default=s.registerStore({init(){return n(this,void 0,void 0,(function*(){this.nextState({users:[]})}))},actions:r})},function(t,e,i){"use strict";var n=this&&this.__awaiter||function(t,e,i,n){return new(i||(i=Promise))((function(s,r){function a(t){try{c(n.next(t))}catch(t){r(t)}}function o(t){try{c(n.throw(t))}catch(t){r(t)}}function c(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,o)}c((n=n.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),r={action_AddMessage(t){return n(this,void 0,void 0,(function*(){this.nextState({messages:[...this.getState().messages,t]})}))},action_RemoveUser(t){return n(this,void 0,void 0,(function*(){this.nextState({messages:this.getState().messages.filter(e=>e.author!==t.userId)})}))},action_RemoveMessage(t){return n(this,void 0,void 0,(function*(){this.nextState({messages:this.getState().messages.filter(e=>e.id!==t.messageId)})}))},action_RemoveChannel(t){return n(this,void 0,void 0,(function*(){this.nextState({messages:this.getState().messages.filter(e=>e.channel!==t.channelId)})}))}};e.default=s.registerStore({init(){return n(this,void 0,void 0,(function*(){this.nextState({messages:[]})}))},actions:r})},function(t,e,i){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=n(i(1)),r=n(i(3)),a=n(i(4)),o=n(i(10));Vue.component("channels",{template:'\n  <div class="globalContainer">\n      <div class="channelItem" v-for="channel in channels">\n        <div class="header">  \n          <h3>{{channel.name}}</h3>\n          <div v-for="user in channel.users">\n            User  {{ user.name }} is in the channel\n          </div>\n        </div>\n        <hr />\n        <h4>Messages in {{channel.name}}</h4>\n        <div v-for="msg in channel.messages">\n          <span :class="[\'msg_\' + msg.author]">{{msg.userName}}: {{msg.body}}</span>\n        </div>\n      </div>\n  </div>\n  ',props:["channels"]});new Vue({el:"#app",data:{channels:[]},mounted:function(){o.default.subscribeTo.All(t=>{this.channels=t.channels}),setTimeout(()=>{!function t(){const e=[];e.push(()=>s.default.actions.action_AddChannel({id:1,name:"Channel 1"})),e.push(()=>s.default.actions.action_AddChannel({id:2,name:"Channel 2"})),e.push(()=>{r.default.actions.action_AddUser({id:1,name:"User 1"}),r.default.actions.action_AddUser({id:2,name:"User 2"}),r.default.actions.action_AddUser({id:3,name:"User 3"})}),e.push(()=>r.default.actions.action_AddUserToChannel({userId:1,channelId:1})),e.push(()=>r.default.actions.action_AddUserToChannel({userId:2,channelId:1})),e.push(()=>a.default.actions.action_AddMessage({timestamp:(new Date).getTime(),id:0,author:1,channel:1,body:"Hello user 2"})),e.push(()=>r.default.actions.action_AddUserToChannel({userId:2,channelId:2})),e.push(()=>r.default.actions.action_AddUserToChannel({userId:3,channelId:2})),e.push(()=>a.default.actions.action_AddMessage({timestamp:(new Date).getTime(),id:1,author:2,channel:1,body:"Hello user 1"})),e.push(()=>{a.default.actions.action_AddMessage({timestamp:(new Date).getTime(),id:2,author:2,channel:2,body:"Hello User 3 !!"}),a.default.actions.action_AddMessage({timestamp:(new Date).getTime(),id:2,author:1,channel:1,body:"Say hello to user 3 for me"})}),e.push(()=>a.default.actions.action_AddMessage({timestamp:(new Date).getTime(),id:3,author:2,channel:2,body:"User 1 say hello to you"})),e.push(()=>a.default.actions.action_AddMessage({timestamp:(new Date).getTime(),id:4,author:3,channel:2,body:"Hello user 2, thanks !"})),e.push(()=>a.default.actions.action_RemoveChannel({channelId:2})),e.push(()=>a.default.actions.action_RemoveChannel({channelId:1})),e.push(()=>setTimeout(()=>{t()},200)),e.forEach((t,i)=>{setTimeout(()=>{e.shift()()},200*i)})}()},200)}})},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.constantTree=void 0,e.constantTree=function t(e,i=""){for(const n in e){const s=`${i}${""!==i?".":""}${n}`;"string"!=typeof e[n]||0!==e[n].length?"object"==typeof e[n]&&t(e[n],s):e[n]=s}return e}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.EventBus=void 0;e.EventBus=class{constructor(t=".",e=3){this._Emitter_={oncePool:{},onPool:{},parent:void 0,Ids:0},""===t.trim()&&(t="."),e<1&&(e=1),this._separator=t,this._depthLevel=e}get _errors(){const t=this;return{get eventNameBadFormat(){return`The event name is not in the correct format :\nShould be in '${t._depthLevel}' part${t._depthLevel>1?"s":""}\n${t._depthLevel>1?"separated by '"+t._separator+"'":""}`}}}checkEventNameFormat(t){return t&&t.trim().length>0&&t.split(this._separator).length<=this._depthLevel||!1}get pools(){return[this._Emitter_.onPool,this._Emitter_.oncePool]}get separator(){return this._separator}set separator(t){""===t.trim()&&(t="."),this._separator=t}get parent(){return this._Emitter_.parent}set parent(t){this._Emitter_.parent=t}get depthLevel(){return this._depthLevel}set depthLevel(t){t<1&&(t=1),this._depthLevel=t}on(t,e){if(!this.checkEventNameFormat(t))throw Error(this._errors.eventNameBadFormat);this._Emitter_.onPool[t]||(this._Emitter_.onPool[t]=[]);let i={id:this._Emitter_.Ids++,callback:e};return this._Emitter_.onPool[t].push(i),this.emit("registerEvent",{eventName:t,callback:e}),{off:()=>this.off(i.id),id:i.id}}once(t,e){if(!this.checkEventNameFormat(t))throw Error(this._errors.eventNameBadFormat);this._Emitter_.oncePool[t]||(this._Emitter_.oncePool[t]=[]);let i={id:this._Emitter_.Ids++,callback:t=>{this.off(i.id),e(t)},originalCallback:e};return this._Emitter_.oncePool[t].push(i),this.emit("registerEvent",{eventName:t,callback:i.callback}),{off:()=>this.off(i.id),id:i.id}}off(...t){let e=void 0,i=void 0,n=void 0;if(0===t.length||!t)return this._Emitter_.oncePool={},void(this._Emitter_.onPool={});if(1===t.length)switch(typeof t[0]){case"string":e=t[0];break;case"number":n=t[0];break;default:i=t[0]}else e=t[0],i=t[1],n=t[2]||void 0;if(e&&"string"==typeof e){const t=e;this.pools.forEach(e=>{let n=e[t]||[];i&&(n=n.filter(t=>t.originalCallback?t.originalCallback===i:t.callback===i)),n.forEach(i=>{e[t]=e[t].filter(t=>t.id!==i.id)})})}else[this._Emitter_.onPool,this._Emitter_.oncePool].forEach(t=>{for(let e in t){let s=t[e];n&&(s=s.filter(t=>t.id===n)),i&&(s=s.filter(t=>t.originalCallback?t.originalCallback===i:t.callback===i)),s.forEach(i=>{t[e]=t[e].filter(t=>t.id!==i.id)})}})}emit(t,e){return"allEvents"!==t&&this.emit("allEvents",{eventName:t,data:e}),this.pools.forEach(i=>{for(const n in i){const s=n.split(this._separator),r=t.split(this._separator);for(;r.length>0&&s.length<r.length;)r.pop();"string"==typeof n&&s.join()===r.join()&&i[n].forEach(i=>{"allEvents"!==t&&this.emit("allEvents",{eventName:"callback."+t,data:i.id}),i.callback(e)})}}),this._Emitter_.parent&&this._Emitter_.parent.emit(t,e),!0}emitAsync(t,e){return setTimeout(()=>{this.pools.forEach(i=>{for(const n in i){const s=n.split(this._separator),r=t.split(this._separator);for(;r.length>0&&s.length<r.length;)r.pop();"string"==typeof n&&s.join()===r.join()&&i[n].forEach(t=>t.callback(e))}}),this._Emitter_.parent&&this._Emitter_.parent.emitAsync(t,e),"allEvents"!==t&&this.emitAsync("allEvents",{eventName:t,data:e})},0),!0}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Guid=void 0;class n{constructor(){const[t,e]=n.generate4bytesNumber(),[i,s]=n.generate2bytesNumber(),[r,a]=n.generate2bytesNumber(),[o,c]=n.generate2bytesNumber(),[h,d]=n.generate6bytesNumber();this._Guid_={part1:t,part2:i,part3:r,part4:o,part5:h,toString:`${e}-${s}-${a}-${c}-${d}`}}static generate2bytesNumber(){const t=Math.round(65535*Math.random());return[t,n.pad(t.toString(16),4)]}static generate4bytesNumber(){const t=Math.round(4294967295*Math.random());return[t,n.pad(t.toString(16),8)]}static generate6bytesNumber(){const t=Math.round(0xffffffffffff*Math.random());return[t,n.pad(t.toString(16),12)]}static pad(t,e){var i="";for(let t=0;t<e;t++)i+="0";return(i+t).substr(-e)}get part1(){return this._Guid_.part1}get part2(){return this._Guid_.part2}get part3(){return this._Guid_.part3}get part4(){return this._Guid_.part4}get part5(){return this._Guid_.part5}toString(){return this._Guid_.toString}static getGuid(){return(new n).toString()}}e.Guid=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.registerStore=e.withEvents=e.BaseStore=void 0;const n=i(2);class s{constructor(){this.id="",this.init=()=>{},this.nextState=(t,e)=>{},this.sendAction=(t,e)=>{}}getState(){return this.state}}e.BaseStore=s,e.withEvents=function(t){for(const e in t)t[e]=e;return t},e.registerStore=function(t){const e=this;e.__dispatcher||(e.__dispatcher=new n.Dispatcher);const i=new s;i.mappedActions=t.mappedActions,e.__dispatcher.registerStore(i,t.id);const r={};for(const n in t.actions)r[n]=i=>{e.__dispatcher.dispatch(Object.assign({type:t.localActions?`${t.id}-${n}`:n},i))},i[t.localActions?`${t.id}-${n}`:n]=t.actions[n];t.dispatchHandler&&(i.dispatchHandler=t.dispatchHandler);const a={};for(const n in t.events)a[n]=t=>e.__dispatcher.subscribe(i.id,t,n);return a.All=t=>e.__dispatcher.subscribe(i.id,t,"ALL"),t.init&&(i.init=t.init,i.init()),t.nextState&&(i.nextState=t.nextState),{id:i.id,actions:r,subscribeTo:a,getState:()=>i.state}}.bind({__dispatcher:new n.Dispatcher})},function(t,e,i){"use strict";var n=this&&this.__awaiter||function(t,e,i,n){return new(i||(i=Promise))((function(s,r){function a(t){try{c(n.next(t))}catch(t){r(t)}}function o(t){try{c(n.throw(t))}catch(t){r(t)}}function c(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,o)}c((n=n.apply(t,e||[])).next())}))},s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i(1)),a=s(i(3)),o=s(i(4)),c=i(0),h={dispatchHandler(t,e){return n(this,void 0,void 0,(function*(){yield e(o.default.id,a.default.id,r.default.id);const t=r.default.getState().channels,i=a.default.getState().users,n=o.default.getState().messages.sort((t,e)=>t.timestamp-e.timestamp),s={channels:t.map(t=>(t.messages=n.filter(e=>e.channel===t.id).map(t=>Object.assign(Object.assign({},t),{userName:i.filter(e=>e.id===t.author)[0].name})),t.users=i.filter(e=>-1!==e.channels.indexOf(t.id)),t))};this.nextState(s)}))}};e.default=c.registerStore({init(){return n(this,void 0,void 0,(function*(){this.nextState({channels:[]})}))},actions:h})}]);