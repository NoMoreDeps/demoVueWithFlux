!function(e){var t={};function n(s){if(t[s])return t[s].exports;var i=t[s]={i:s,l:!1,exports:{}};return e[s].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,s){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(n.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(s,i,function(t){return e[t]}.bind(null,i));return s},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=1)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3);t.Dispatcher=s.Dispatcher;const i=n(8);t.BaseStore=i.BaseStore;const r=n(10);t.Subscriber=r.Subscriber},function(e,t,n){"use strict";var s=this&&this.__createBinding||(Object.create?function(e,t,n,s){void 0===s&&(s=n),Object.defineProperty(e,s,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,s){void 0===s&&(s=n),e[s]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.hasOwnProperty.call(e,n)&&s(t,e,n);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0});const a=r(n(2));window.Flux=a,Vue.component("channels",{template:'\n  <div class="globalContainer">\n      <div class="channelItem" v-for="channel in channels">\n        <div class="header">  \n          <h3>{{channel.name}}</h3>\n          <div v-for="user in channel.users">\n            User  {{ user.name }} is in the channel\n          </div>\n        </div>\n        <hr />\n        <h4>Messages in {{channel.name}}</h4>\n        <div v-for="msg in channel.messages">\n          <span :class="[\'msg_\' + msg.author]">{{msg.userName}}: {{msg.body}}</span>\n        </div>\n      </div>\n  </div>\n  ',props:["channels"]});new Vue({el:"#app",data:{channels:[]},mounted:function(){a.subscriber.subscribe("APP",e=>{this.channels=e.channels}),setTimeout(()=>{!function e(){const t=[];t.push(()=>a.channelActions.addChannel({id:1,name:"Channel 1"})),t.push(()=>a.channelActions.addChannel({id:2,name:"Channel 2"})),t.push(()=>{a.userActions.addUser({id:1,name:"User 1"}),a.userActions.addUser({id:2,name:"User 2"}),a.userActions.addUser({id:3,name:"User 3"})}),t.push(()=>a.userActions.addUserToChannel(1,1)),t.push(()=>a.userActions.addUserToChannel(2,1)),t.push(()=>a.messageActions.addMessage({id:0,author:1,channel:1,body:"Hello user 2"})),t.push(()=>a.userActions.addUserToChannel(2,2)),t.push(()=>a.userActions.addUserToChannel(3,2)),t.push(()=>a.messageActions.addMessage({id:1,author:2,channel:1,body:"Hello user 1"})),t.push(()=>{a.messageActions.addMessage({id:2,author:2,channel:2,body:"Hello User 3 !!"}),a.messageActions.addMessage({id:2,author:1,channel:1,body:"Say hello to user 3 for me"})}),t.push(()=>a.messageActions.addMessage({id:3,author:2,channel:2,body:"User 1 say hello to you"})),t.push(()=>a.messageActions.addMessage({id:4,author:3,channel:2,body:"Hello user 2, thanks !"})),t.push(()=>a.channelActions.removeChannel(2)),t.push(()=>a.channelActions.removeChannel(1)),t.push(()=>setTimeout(()=>{e()},1e3)),t.forEach((e,n)=>{setTimeout(()=>{t.shift()()},1e3*n)})}()},1500)}})},function(e,t,n){"use strict";var s=this&&this.__createBinding||(Object.create?function(e,t,n,s){void 0===s&&(s=n),Object.defineProperty(e,s,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,s){void 0===s&&(s=n),e[s]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.hasOwnProperty.call(e,n)&&s(t,e,n);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.messageActions=t.userActions=t.channelActions=t.subscriber=void 0;const a=r(n(0)),o=n(11);Object.defineProperty(t,"channelActions",{enumerable:!0,get:function(){return o.channelActions}});const c=n(12);Object.defineProperty(t,"userActions",{enumerable:!0,get:function(){return c.userActions}});const h=n(13);Object.defineProperty(t,"messageActions",{enumerable:!0,get:function(){return h.messageActions}});const u=n(14),d=new a.Dispatcher,l=new a.Subscriber(d);t.subscriber=l;const f=new o.ChannelStore,p=new c.UserStore,_=new h.MessageStore,g=new u.ChatAppStore;d.register(f,"CHANNEL"),d.register(p,"USER"),d.register(_,"MESSAGE"),d.register(g,"APP"),[o.channelActions,c.userActions,h.messageActions].forEach(e=>{for(const t in e)e[t]=e[t].bind(l)})},function(e,t,n){"use strict";var s=this&&this.__awaiter||function(e,t,n,s){return new(n||(n=Promise))((function(i,r){function a(e){try{c(s.next(e))}catch(e){r(e)}}function o(e){try{c(s.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}c((s=s.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const i=n(4),r=n(5),a=n(6),o=n(7);t.Dispatcher=class{constructor(){this.messagingHandler=e=>{var t;switch(e.data.topic){case"count":this.sendMsg({topic:"count",value:this.debug.getFrames().length});break;case"getFrames":this.sendMsg({topic:"getFrames",value:this.debug.getFrames()});break;case"playFrame":this.debug.goToFrame(e.data.value),this.debug.playCurrentFrame(),this.sendMsg({topic:"playFrame"});break;case"clear":null===(t=this._debugCycle)||void 0===t||t.clear(),this.sendMsg({topic:"clear"})}},this.debug={setDebugOn:e=>{this._debugOptions=e,this.debugHelper.setDebugState(!0),this.activateCrossMessaging()},setDebugOff:()=>{this.debugHelper.setDebugState(!1),this.deactivateCrossMessaging()},lockState:e=>{this._debugMode&&this._stores.forEach(t=>this._eventBus.emit(t.id+".lockState",e))},getFrameLength:()=>this.debugHelper.countUpdates(),goToFrame:e=>{this._debugCycle&&(this._debugCycle.frameIndex=e)},playCurrentFrame:()=>{this._debugCycle&&this._debugCycle.playCurrentFrame()},getFrames:()=>this._debugCycle&&this._debugCycle.getFrames()},this.debugHelper={setDebugState:e=>{this._debugMode=e,e?!this._debugCycle&&(this._debugCycle=new o.DispatcherCycle(this)):this._debugCycle&&(this._debugCycle._events.length=0,this._debugCycle=null)},countUpdates:()=>this._debugCycle?this._debugCycle.length:0},this._payloads=[],this._stores=[],this._storeHash={},this._isDispatching=!1,this._currentStoreTab={},this._eventBus=new a.EventBus,this._debugCycle=null,this._debugMode=!1,this._currentFrame=null,this._isPlayingDebug=!1,this._debugOptions={mode:"local"},this._debugWindow=null,this._eventBus.on("allEvents",e=>{this.addTrace(e.eventName,e.data)})}waitFor(...e){return s(this,void 0,void 0,(function*(){const t=e.map(e=>this._currentStoreTab[e].getPromise());yield Promise.all(t)}))}addTrace(e,t){this._debugMode&&this._isDispatching&&this._debugCycle&&this._debugCycle.newEvent(e,t)}addDispatcherTrace(e,t){this._debugMode&&this._debugCycle&&this._debugCycle.newEvent(e,t)}formatErrorTrace(e){return"object"==typeof e&&"message"in e?{name:e.name,message:e.message,stack:e.stack}:e}processNextPayload(){const e=this._payloads.shift();if(!e)return void(this._isDispatching=!1);this.addDispatcherTrace("dispatcher.newCycle",null),this._isDispatching=!0;const t=this._stores.map(t=>{const n=new r.DefferedPromise((n,i)=>{let r=!1,a=!1;const o=()=>{!r&&n(),r=!0},c=e=>{a||(a=!0,this.addTrace("store.Error",{owner:t.id,error:this.formatErrorTrace(e)}),this._eventBus.emit("Dispatcher.Store.Error",{owner:t.id,error:e}),n())};this.addTrace("store.Process",{owner:t.id}),t.dispatchHandler(e,o,c,(...e)=>s(this,void 0,void 0,(function*(){this.addTrace("store.WaitFor",{owner:t.id,waitList:e}),yield this.waitFor(...e),this.addTrace("store.EndWaitFor",{owner:t.id,waitList:e})}))).then(()=>o()).catch(e=>c(e))});return this._currentStoreTab[t.id]=n,n});this.addTrace("dispatcher.dispatch",e),Promise.all(t.map(e=>e.getPromise())).then(()=>{this.addTrace("dispatcher.endCycle",null),this.sendMsg({topic:"getFrames",value:this.debug.getFrames()}),this._currentStoreTab={},this._payloads.length>0?setTimeout(()=>{this.processNextPayload()},0):this._isDispatching=!1})}onError(e){return this._eventBus.on("Dispatcher.Store.Error",e)}register(e,t=""){const n=e;if(!n.id&&(n.id=t||i.Guid.getGuid()),this._storeHash[n.id])throw`A store with id ${n.id} already exists.`;this._storeHash[n.id]=n,this._stores.push(n),n.registerEventBus(this._eventBus),n.getStoreStateByToken=e=>this._storeHash[e].getState(),n.sendAction=e=>{this.dispatch(e)}}subscribe(...e){const t=()=>{throw`subscribe function has no signature corresponding to the one you provided :\n      subscribe(${e.map(e=>typeof e).join(", ")}) => void; not found !`};0===e.length&&t(),"string"!=typeof e[0]&&t();let n=e.shift();if(0===this._stores.filter(e=>e.id===n).length)throw`Cannot subscribe to the store ${n}. This store does not exists or is not registered into the dispatcher.`;if(1===e.length){if("function"==typeof e[0])return this._eventBus.on(n+".updated",t=>{(0,e[0])(t.getState())});t()}else if(2===e.length){if("function"==typeof e[0]&&"function"==typeof e[1])return this._eventBus.on(n+".updated",t=>{const n=e[0];(0,e[1])(n(t.getState()))});if("string"==typeof e[0]&&"function"==typeof e[1]){const t=e[0];return this._eventBus.on(`${n}.updated.${t}`,t=>{(0,e[1])(t.getState())})}t()}else if(3===e.length){if("string"==typeof e[0]&&"function"==typeof e[1]&&"function"==typeof e[2]){const t=e[0];return this._eventBus.on(`${n}.updated.${t}`,t=>{const n=e[1];(0,e[2])(n(t.getState()))})}t()}else t()}unregister(e){this._stores=this._stores.filter(t=>t.id!==e.id),delete this._storeHash[e.id]}dispatch(e){this._isPlayingDebug||(this._debugMode&&this._eventBus.emit("dispatcher.stack",e),this._payloads.push(e),!this._isDispatching&&this.processNextPayload())}sendMsg(e){var t;null===(t=this._debugWindow)||void 0===t||t.postMessage(JSON.parse(JSON.stringify(e)),this._debugOptions.url)}activateCrossMessaging(){"postMessage"===this._debugOptions.mode&&(this._debugWindow=window.open(`${this._debugOptions.url}?source=${window.origin}`,"_shadow_flux_"));try{window&&window.addEventListener&&window.addEventListener("message",this.messagingHandler)}catch(e){}}deactivateCrossMessaging(){try{window&&window.addEventListener&&window.removeEventListener("message",this.messagingHandler)}catch(e){}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class s{constructor(){const[e,t]=s.generate4bytesNumber(),[n,i]=s.generate2bytesNumber(),[r,a]=s.generate2bytesNumber(),[o,c]=s.generate2bytesNumber(),[h,u]=s.generate6bytesNumber();this._Guid_={part1:e,part2:n,part3:r,part4:o,part5:h,toString:`${t}-${i}-${a}-${c}-${u}`}}static generate2bytesNumber(){const e=Math.round(65535*Math.random());return[e,s.pad(e.toString(16),4)]}static generate4bytesNumber(){const e=Math.round(4294967295*Math.random());return[e,s.pad(e.toString(16),8)]}static generate6bytesNumber(){const e=Math.round(0xffffffffffff*Math.random());return[e,s.pad(e.toString(16),12)]}static pad(e,t){var n="";for(let e=0;e<t;e++)n+="0";return(n+e).substr(-t)}get part1(){return this._Guid_.part1}get part2(){return this._Guid_.part2}get part3(){return this._Guid_.part3}get part4(){return this._Guid_.part4}get part5(){return this._Guid_.part5}toString(){return this._Guid_.toString}static getGuid(){return(new s).toString()}}t.Guid=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.DefferedPromise=class{constructor(e){this.instance=null,this.executor=e}getPromise(){return this.instance||(this.instance=new Promise(this.executor)),this.instance}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.EventBus=class{constructor(e=".",t=3){this._Emitter_={oncePool:{},onPool:{},parent:void 0,Ids:0},""===e.trim()&&(e="."),t<1&&(t=1),this._separator=e,this._depthLevel=t}get _errors(){const e=this;return{get eventNameBadFormat(){return`The event name is not in the correct format :\nShould be in '${e._depthLevel}' part${e._depthLevel>1?"s":""}\n${e._depthLevel>1?"separated by '"+e._separator+"'":""}`}}}checkEventNameFormat(e){return e&&e.trim().length>0&&e.split(this._separator).length<=this._depthLevel||!1}get pools(){return[this._Emitter_.onPool,this._Emitter_.oncePool]}get separator(){return this._separator}set separator(e){""===e.trim()&&(e="."),this._separator=e}get parent(){return this._Emitter_.parent}set parent(e){this._Emitter_.parent=e}get depthLevel(){return this._depthLevel}set depthLevel(e){e<1&&(e=1),this._depthLevel=e}on(e,t){if(!this.checkEventNameFormat(e))throw Error(this._errors.eventNameBadFormat);this._Emitter_.onPool[e]||(this._Emitter_.onPool[e]=[]);let n={id:this._Emitter_.Ids++,callback:t};return this._Emitter_.onPool[e].push(n),this.emit("registerEvent",{eventName:e,callback:t}),{off:()=>this.off(n.id),id:n.id}}once(e,t){if(!this.checkEventNameFormat(e))throw Error(this._errors.eventNameBadFormat);this._Emitter_.oncePool[e]||(this._Emitter_.oncePool[e]=[]);let n={id:this._Emitter_.Ids++,callback:e=>{this.off(n.id),t(e)},originalCallback:t};return this._Emitter_.oncePool[e].push(n),this.emit("registerEvent",{eventName:e,callback:n.callback}),{off:()=>this.off(n.id),id:n.id}}off(...e){let t=void 0,n=void 0,s=void 0;if(0===e.length||!e)return this._Emitter_.oncePool={},void(this._Emitter_.onPool={});if(1===e.length)switch(typeof e[0]){case"string":t=e[0];break;case"number":s=e[0];break;default:n=e[0]}else t=e[0],n=e[1],s=e[2]||void 0;if(t&&"string"==typeof t){const e=t;this.pools.forEach(t=>{let s=t[e]||[];n&&(s=s.filter(e=>e.originalCallback?e.originalCallback===n:e.callback===n)),s.forEach(n=>{t[e]=t[e].filter(e=>e.id!==n.id)})})}else[this._Emitter_.onPool,this._Emitter_.oncePool].forEach(e=>{for(let t in e){let i=e[t];s&&(i=i.filter(e=>e.id===s)),n&&(i=i.filter(e=>e.originalCallback?e.originalCallback===n:e.callback===n)),i.forEach(n=>{e[t]=e[t].filter(e=>e.id!==n.id)})}})}emit(e,t){return"allEvents"!==e&&this.emit("allEvents",{eventName:e,data:t}),this.pools.forEach(n=>{for(const s in n){const i=s.split(this._separator),r=e.split(this._separator);for(;r.length>0&&i.length<r.length;)r.pop();"string"==typeof s&&i.join()===r.join()&&n[s].forEach(n=>{"allEvents"!==e&&this.emit("allEvents",{eventName:"callback."+e,data:n.id}),n.callback(t)})}}),this._Emitter_.parent&&this._Emitter_.parent.emit(e,t),!0}emitAsync(e,t){return setTimeout(()=>{this.pools.forEach(n=>{for(const s in n){const i=s.split(this._separator),r=e.split(this._separator);for(;r.length>0&&i.length<r.length;)r.pop();"string"==typeof s&&i.join()===r.join()&&n[s].forEach(e=>e.callback(t))}}),this._Emitter_.parent&&this._Emitter_.parent.emitAsync(e,t),"allEvents"!==e&&this.emitAsync("allEvents",{eventName:e,data:t})},0),!0}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.DispatcherCycle=class{constructor(e){this._events=[],this._cycleIndex=[],this._frameIndex=0,this._dispatcher=e}clear(){this._events.length=0}get length(){return this._cycleIndex.length}getFrameStartEnd(e){return[this._cycleIndex[e],(()=>this._cycleIndex[e+1]?this._cycleIndex[e+1]-1:this._events.length)()]}getFrameContent(e){return this._events.slice(...this.getFrameStartEnd(e))}get frameIndex(){return this._frameIndex}set frameIndex(e){this._frameIndex=e<this.length?e:this.length-1,this._frameIndex<0&&(this._frameIndex=0)}playCurrentFrame(){this._dispatcher._isPlayingDebug=!0;this.getFrameContent(this._frameIndex).filter(e=>"UpdatedState"===e.type).forEach(e=>{this._dispatcher._eventBus.emit(e.storeId+".setState",e.storeState),this._dispatcher._eventBus.emit(e.fullEvent,{getState:()=>e.storeState})}),this._dispatcher._isPlayingDebug=!1}getFrames(){const e=[];for(let t=0;t<this.length;t++)e.push(this.getFrameContent(t));return e}newEvent(e,t){if(this._dispatcher._isPlayingDebug)return;const n=e.split(".");"callback"!==n[0]?"nextState"!==n[1]?"updated"!==n[1]?"dispatcher.newCycle"!==e?"dispatcher.stack"!==e?"dispatcher.endCycle"!==e?"dispatcher.dispatch"!==e?"store.WaitFor"!==e?"store.EndWaitFor"!==e?"store.Process"!==e?this._events.push({time:Date.now(),type:"NotProcessed",eventName:e,data:t}):this._events.push({time:Date.now(),type:"StoreProcess",owner:t.owner}):this._events.push({time:Date.now(),type:"EndWaitFor",owner:t.owner,waitList:t.waitList}):this._events.push({time:Date.now(),type:"WaitFor",owner:t.owner,waitList:t.waitList}):this._events.push({time:Date.now(),type:"Dispatch",payload:t}):this._events.push({time:Date.now(),type:"EndCycle"}):this._events.push({time:Date.now(),type:"Stack",payload:t}):this._cycleIndex.push(this._events.push({time:Date.now(),type:"NewCycle"})-1):this._events.push({time:Date.now(),type:"UpdatedState",storeId:n[0],fullEvent:e,storeState:t.getState()}):this._events.push({time:Date.now(),type:"NextState",storeId:n[0],storeState:t.getState()}):this._events.push({time:Date.now(),type:"CallBack",id:t,event:e})}}},function(e,t,n){"use strict";var s=this&&this.__awaiter||function(e,t,n,s){return new(n||(n=Promise))((function(i,r){function a(e){try{c(s.next(e))}catch(e){r(e)}}function o(e){try{c(s.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}c((s=s.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const i=n(9);t.BaseStore=class{constructor(){this.getStoreStateByToken=()=>{},this.sendAction=e=>{},this.id="",this.state={},this._eventBus=null,this._lockState=!1,this.initState(),this.actionStrategy=new i.BaseActionStrategy}registerEventBus(e){this._eventBus=e,this._eventBus.on(this.id+".lockState",e=>{this._lockState=e}),this._eventBus.on(this.id+".setState",e=>{this._lockState&&(this.state=e)})}emit(e=""){this._lockState||(""===e?e="updated":e.startsWith("updated")||(e="updated."+e),this._eventBus&&this._eventBus.emit(`${this.id}.${e}`,this))}getState(){return this.state}nextState(e){this._lockState||(this.state="function"==typeof e?e(this.state):Object.assign({},this.state,e),this._eventBus&&this._eventBus.emit(this.id+".nextState",this))}dispatchHandler(e,t,n,i){return s(this,void 0,void 0,(function*(){yield this.actionStrategy.resolve(this,e,t,n,i)}))}}},function(e,t,n){"use strict";var s=this&&this.__awaiter||function(e,t,n,s){return new(n||(n=Promise))((function(i,r){function a(e){try{c(s.next(e))}catch(e){r(e)}}function o(e){try{c(s.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}c((s=s.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});t.BaseActionStrategy=class{resolve(e,t,n,i,r){return s(this,void 0,void 0,(function*(){"action"+t.type in e&&(yield e["action"+t.type](t,n,i,r))}))}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Subscriber=class{constructor(e){this.dispatcher=e}onError(e){return this.dispatcher.onError(e)}subscribe(...e){return this.dispatcher.subscribe.apply(this.dispatcher,e)}sendAction(...e){2===e.length?this.dispatcher.dispatch(Object.assign({type:e[0]},e[1])):this.dispatcher.dispatch(e[0])}}},function(e,t,n){"use strict";var s=this&&this.__createBinding||(Object.create?function(e,t,n,s){void 0===s&&(s=n),Object.defineProperty(e,s,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,s){void 0===s&&(s=n),e[s]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.hasOwnProperty.call(e,n)&&s(t,e,n);return i(t,e),t},a=this&&this.__awaiter||function(e,t,n,s){return new(n||(n=Promise))((function(i,r){function a(e){try{c(s.next(e))}catch(e){r(e)}}function o(e){try{c(s.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}c((s=s.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.channelActions=t.ChannelStore=void 0;const o=r(n(0));class c extends o.BaseStore{constructor(){super(...arguments),this.action_AddChannel=function(e){return a(this,void 0,void 0,(function*(){this.nextState(t=>{var n;return null===(n=t.channels)||void 0===n||n.push(e),t}),this.emit()}))},this.action_RemoveChannel=function(e){return a(this,void 0,void 0,(function*(){this.nextState(t=>(t.channels=t.channels.filter(t=>t.id!==e.channelId),t)),this.emit()}))}}initState(){this.nextState({channels:[]})}}t.ChannelStore=c,t.channelActions={addChannel(e){this.sendAction("_AddChannel",e)},removeChannel(e){this.sendAction({type:"_RemoveChannel",channelId:e})}}},function(e,t,n){"use strict";var s=this&&this.__createBinding||(Object.create?function(e,t,n,s){void 0===s&&(s=n),Object.defineProperty(e,s,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,s){void 0===s&&(s=n),e[s]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.hasOwnProperty.call(e,n)&&s(t,e,n);return i(t,e),t},a=this&&this.__awaiter||function(e,t,n,s){return new(n||(n=Promise))((function(i,r){function a(e){try{c(s.next(e))}catch(e){r(e)}}function o(e){try{c(s.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}c((s=s.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.userActions=t.UserStore=void 0;const o=r(n(0));class c extends o.BaseStore{constructor(){super(...arguments),this.action_AddUser=function(e){return a(this,void 0,void 0,(function*(){this.nextState(t=>{var n;return null===(n=t.users)||void 0===n||n.push(Object.assign(Object.assign({},e),{channels:[]})),t}),this.emit()}))},this.action_AddUserToChannel=function(e){return a(this,void 0,void 0,(function*(){this.nextState(t=>(t.users.filter(t=>t.id===e.userId)[0].channels.push(e.channelId),t)),this.emit()}))},this.action_RemoveUser=function(e){return a(this,void 0,void 0,(function*(){this.nextState(t=>(t.users=t.users.filter(t=>t.id!==e.userId),t)),this.emit()}))},this.action_RemoveChannel=function(e){return a(this,void 0,void 0,(function*(){this.nextState(t=>(t.users.forEach(t=>{-1!==t.channels.indexOf(e.channelId)&&(t.channels=t.channels.filter(t=>t!==e.channelId))}),t)),this.emit()}))}}initState(){this.nextState({users:[]})}}t.UserStore=c,t.userActions={addUser(e){this.sendAction("_AddUser",e)},addUserToChannel(e,t){this.sendAction({type:"_AddUserToChannel",userId:e,channelId:t})},removeUser(e){this.sendAction({type:"_RemoveUser",userId:e})}}},function(e,t,n){"use strict";var s=this&&this.__createBinding||(Object.create?function(e,t,n,s){void 0===s&&(s=n),Object.defineProperty(e,s,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,s){void 0===s&&(s=n),e[s]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.hasOwnProperty.call(e,n)&&s(t,e,n);return i(t,e),t},a=this&&this.__awaiter||function(e,t,n,s){return new(n||(n=Promise))((function(i,r){function a(e){try{c(s.next(e))}catch(e){r(e)}}function o(e){try{c(s.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}c((s=s.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.messageActions=t.MessageStore=void 0;const o=r(n(0));class c extends o.BaseStore{constructor(){super(...arguments),this.action_AddMessage=function(e){return a(this,void 0,void 0,(function*(){this.nextState(t=>{var n;return null===(n=t.messages)||void 0===n||n.push(e),t}),this.emit()}))},this.action_RemoveUser=function(e){return a(this,void 0,void 0,(function*(){this.nextState(t=>(t.messages=t.messages.filter(t=>t.author!==e.userId),t)),this.emit()}))},this.action_RemoveMessage=function(e){return a(this,void 0,void 0,(function*(){this.nextState(t=>(t.messages=t.messages.filter(t=>t.id!==e.messageId),t)),this.emit()}))},this.action_RemoveChannel=function(e){return a(this,void 0,void 0,(function*(){this.nextState(t=>(t.messages=t.messages.filter(t=>t.channel!==e.channelId),t)),this.emit()}))}}initState(){this.nextState({messages:[]})}}t.MessageStore=c,t.messageActions={addMessage(e){e.timestamp=performance.now(),this.sendAction("_AddMessage",e)},removeMessage(e){this.sendAction({type:"_RemoveMessage",messageId:e})}}},function(e,t,n){"use strict";var s=this&&this.__createBinding||(Object.create?function(e,t,n,s){void 0===s&&(s=n),Object.defineProperty(e,s,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,s){void 0===s&&(s=n),e[s]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.hasOwnProperty.call(e,n)&&s(t,e,n);return i(t,e),t},a=this&&this.__awaiter||function(e,t,n,s){return new(n||(n=Promise))((function(i,r){function a(e){try{c(s.next(e))}catch(e){r(e)}}function o(e){try{c(s.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}c((s=s.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.ChatAppStore=void 0;const o=r(n(0));class c extends o.BaseStore{constructor(){super(...arguments),this.dispatchHandler=function(e,t,n,s){return a(this,void 0,void 0,(function*(){yield s("USER","MESSAGE","CHANNEL"),this.nextState(e=>{const t=this.getStoreStateByToken("CHANNEL").channels,n=this.getStoreStateByToken("USER").users,s=this.getStoreStateByToken("MESSAGE").messages.sort((e,t)=>e.timestamp-t.timestamp);return{channels:t.map(e=>(e.messages=s.filter(t=>t.channel===e.id).map(e=>Object.assign(Object.assign({},e),{userName:n.filter(t=>t.id===e.author)[0].name})),e.users=n.filter(t=>-1!==t.channels.indexOf(e.id)),e))}}),this.emit()}))}}initState(){this.nextState({channels:[]})}}t.ChatAppStore=c}]);